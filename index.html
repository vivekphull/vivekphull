<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Historical Figures</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .figure-select {
            margin-bottom: 20px;
        }

        .figure-select label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .figure-select select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .figure-select select:focus {
            outline: none;
            border-color: #667eea;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: #f9f9f9;
        }

        .message {
            margin-bottom: 16px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            text-align: right;
        }

        .message-content {
            display: inline-block;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
        }

        .message.assistant .message-content {
            background: white;
            color: #333;
            border: 2px solid #eee;
        }

        .message-label {
            font-size: 0.85em;
            margin-bottom: 4px;
            opacity: 0.7;
        }

        .input-area {
            display: flex;
            gap: 10px;
        }

        .input-area textarea {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 50px;
            transition: border-color 0.3s;
        }

        .input-area textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-area button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .input-area button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .input-area button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            color: #667eea;
            font-style: italic;
            padding: 10px;
        }

        .error {
            background: #fee;
            border: 2px solid #fcc;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ’¬ Chat with Historical Figures</h1>
            <p>Ask questions and get responses as if you're talking to famous people from history</p>
        </div>
        
        <div class="content">
            <div class="figure-select">
                <label for="historical-figure">Choose a Historical Figure:</label>
                <select id="historical-figure">
                    <option value="Albert Einstein">Albert Einstein</option>
                    <option value="Leonardo da Vinci">Leonardo da Vinci</option>
                    <option value="Cleopatra">Cleopatra</option>
                    <option value="William Shakespeare">William Shakespeare</option>
                    <option value="Marie Curie">Marie Curie</option>
                    <option value="Benjamin Franklin">Benjamin Franklin</option>
                    <option value="Joan of Arc">Joan of Arc</option>
                    <option value="Aristotle">Aristotle</option>
                    <option value="Nikola Tesla">Nikola Tesla</option>
                    <option value="Ada Lovelace">Ada Lovelace</option>
                    <option value="Socrates">Socrates</option>
                    <option value="Abraham Lincoln">Abraham Lincoln</option>
                    <option value="Queen Elizabeth I">Queen Elizabeth I</option>
                    <option value="Confucius">Confucius</option>
                    <option value="Isaac Newton">Isaac Newton</option>
                </select>
            </div>

            <div id="error-message" class="error" style="display: none;"></div>
            
            <div class="chat-container" id="chat-container">
                <div class="message assistant">
                    <div class="message-label">Historical Figure</div>
                    <div class="message-content">
                        Greetings! I am ready to answer your questions. Please select a historical figure and ask me anything.
                    </div>
                </div>
            </div>

            <div class="input-area">
                <textarea 
                    id="question-input" 
                    placeholder="Ask your question here..."
                    rows="2"
                ></textarea>
                <button id="send-button" onclick="sendQuestion()">Send</button>
            </div>
        </div>
    </div>

    <script>
        let conversationHistory = [];

        async function sendQuestion() {
            const input = document.getElementById('question-input');
            const sendButton = document.getElementById('send-button');
            const chatContainer = document.getElementById('chat-container');
            const errorMessage = document.getElementById('error-message');
            const figure = document.getElementById('historical-figure').value;
            const question = input.value.trim();

            if (!question) return;

            errorMessage.style.display = 'none';
            
            addMessage('user', question);
            input.value = '';
            sendButton.disabled = true;

            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.textContent = `${figure} is thinking...`;
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            try {
                conversationHistory.push({
                    role: 'user',
                    content: question
                });

                const systemPrompt = `You are ${figure}. Respond to questions as if you are this historical figure, drawing on their known personality, beliefs, manner of speaking, and historical context. Stay in character and provide responses that reflect their perspective and time period. Be educational but also entertaining. Keep responses concise (1 paragraph unless asked for more detail).`;

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-3-haiku-20240307',
                        max_tokens: 1000,
                        system: systemPrompt,
                        messages: conversationHistory
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                const assistantMessage = data.content[0].text;

                conversationHistory.push({
                    role: 'assistant',
                    content: assistantMessage
                });

                loadingDiv.remove();
                addMessage('assistant', assistantMessage, figure);
            } catch (error) {
                loadingDiv.remove();
                errorMessage.textContent = `Error: ${error.message}`;
                errorMessage.style.display = 'block';
                conversationHistory.pop();
            } finally {
                sendButton.disabled = false;
            }
        }

function addMessage(role, content, figure = '') {
    const chatContainer = document.getElementById('chat-container');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${role}`;
    
    const label = role === 'user' ? 'You' : (figure || 'Historical Figure');
    
    // Random Trump GIFs
    const trumpGifs = [
        'https://media.giphy.com/media/l0HlQ7LRalQqdWfao/giphy.gif',
        'https://media.giphy.com/media/l0MYGb8hCH1Md6UiA/giphy.gif',
        'https://media.giphy.com/media/1luXLMeNxsaNFMUuOe/giphy.gif',
        'https://media.giphy.com/media/14tvbepZ8vhU40/giphy.gif',
        'https://media.giphy.com/media/xT1XGU1AHz9Fe8tmp2/giphy.gif'
    ];
    
    const randomGif = trumpGifs[Math.floor(Math.random() * trumpGifs.length)];
    
    // Add Trump GIF for assistant messages
    const trumpGif = role === 'assistant' ? 
        `<img src="${randomGif}" style="width: 100px; border-radius: 8px; margin-bottom: 10px; display: block;">` : 
        '';
    
    messageDiv.innerHTML = `
        <div class="message-label">${label}</div>
        ${trumpGif}
        <div class="message-content">${escapeHtml(content)}</div>
    `;
    
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.getElementById('question-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendQuestion();
            }
        });

        document.getElementById('historical-figure').addEventListener('change', () => {
            conversationHistory = [];
            const chatContainer = document.getElementById('chat-container');
            const figure = document.getElementById('historical-figure').value;
            chatContainer.innerHTML = `
                <div class="message assistant">
                    <div class="message-label">Historical Figure</div>
                    <div class="message-content">Greetings! I am ${figure}. Ask me anything about my life, work, or views on the world.</div>
                </div>
            `;
        });
    </script>
</body>
</html>
